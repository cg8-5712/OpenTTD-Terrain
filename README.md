# 🏔️ 地形生成器 (Terrain Generator)

一个功能强大的地形生成器，基于物理模拟的地质过程生成真实感地形。支持构造运动、气候侵蚀、河流演化等多种地质过程模拟。

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.7+-green.svg)
![PyQt5](https://img.shields.io/badge/PyQt5-5.15+-orange.svg)

## ✨ 特性

### 🌍 物理模拟
- **构造运动模拟**：支持四种板块边界模式（汇聚型、发散型、转换型、稳定型）
- **气候系统**：包含降水量、温度、风力、距海岸距离等参数
- **侵蚀模拟**：河流侵蚀、冰川侵蚀、风化作用
- **区域分区**：多区域地形生成，支持不同区域的对比度控制

### 🎨 可视化界面
- **实时预览**：支持2D高度图预览和基础3D视图
- **参数控制面板**：直观的滑块和数值输入
- **多视图模式**：高度图、坡度图、河流分布等
- **交互操作**：缩放、平移、旋转等交互功能

### 💾 导出功能
- **多种格式支持**：PNG（8位/16位）、TIFF、RAW、NumPy数组
- **3D网格导出**：OBJ、STL、PLY格式
- **参数保存**：导出时自动保存生成参数和元数据
- **预设管理**：保存和加载常用地形预设

## 📦 安装

### 环境要求

- Python 3.7 或更高版本
- Windows、macOS 或 Linux

### 安装步骤

1. **克隆或下载项目**
```bash
git clone https://github.com/cg8-5712/OpenTTD-Terrain.git
cd Terrain
```

2. **创建虚拟环境（推荐）**
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/macOS
source venv/bin/activate
```

3. **安装依赖**
```bash
pip install -r requirements.txt
```

### 依赖包

```
PyQt5>=5.15.0      # GUI框架
numpy>=1.21.0      # 数值计算
Pillow>=9.0.0      # 图像处理
scipy>=1.7.0       # 科学计算
pyyaml>=6.0        # 配置文件
```

## 🚀 快速开始

### 运行程序

```bash
python terrain_generator.py
```

### 基本使用流程

1. **设置基本参数**
   - 选择地形尺寸（推荐1024x1024）
   - 设置随机种子（可选，用于复现结果）

2. **调整构造参数**
   - 选择板块边界类型（汇聚型产生山脉、发散型产生裂谷等）
   - 调整构造抬升强度（值越大地形越崎岖）
   - 设置岩石硬度和地形年龄

3. **配置气候参数**
   - 设置降水量（影响河流侵蚀）
   - 调整温度（影响冰川作用）
   - 设置风力强度和距海岸距离

4. **生成地形**
   - 点击"生成地形"按钮
   - 等待生成完成（大尺寸地形可能需要较长时间）

5. **导出结果**
   - 选择导出格式
   - 点击"导出"按钮
   - 选择保存位置

## 📖 详细使用

### 参数说明

#### 构造参数 (Tectonic Parameters)

| 参数 | 范围 | 说明 |
|------|------|------|
| **构造抬升强度** | 0.0 - 1.0 | 控制地形的整体高度和起伏程度 |
| **板块边界类型** | convergent/divergent/transform/stable | 汇聚型/发散型/转换型/稳定型 |
| **岩石硬度** | 0.0 - 1.0 | 影响抗侵蚀能力，值越大侵蚀越慢 |
| **地形年龄** | 0.0 - 1.0 | 0=古老磨圆，1=年轻陡峭 |

#### 气候参数 (Climate Parameters)

| 参数 | 范围 | 说明 |
|------|------|------|
| **降水量** | 0.0 - 1.0 | 影响河流密度和侵蚀强度 |
| **温度** | 0.0 - 1.0 | 0=寒冷（冰川作用强），1=炎热 |
| **风力强度** | 0.0 - 1.0 | 影响风化和沙丘形成 |
| **距海岸距离** | 0.0 - 1.0 | 0=沿海湿润，1=内陆干燥 |

#### 高级参数 (Advanced Parameters)

| 参数 | 范围 | 说明 |
|------|------|------|
| **分区数量** | 1 - 10 | 地形分为多个独立区域 |
| **区域对比度** | 0.0 - 1.0 | 不同区域间的高度差异 |
| **侵蚀迭代次数** | 1 - 100 | 侵蚀模拟的精细程度 |
| **河流强度** | 0.0 - 1.0 | 河流侵蚀的强度 |
| **冰川强度** | 0.0 - 1.0 | 冰川作用的强度 |

### 预设系统

程序内置了几个典型地形预设：

- **喜马拉雅山脉**：汇聚型板块边界，高降水，高海拔
- **安第斯山脉**：沿海山脉，构造活跃
- **青藏高原**：高原地形，干燥气候

您也可以保存自定义预设：
1. 调整参数到满意的状态
2. 点击"保存预设"按钮
3. 输入预设名称
4. 下次使用时从预设列表中选择

### 导出格式

#### 图像格式

- **PNG (8位)**：适合预览和展示
- **PNG (16位)**：高精度高度图，推荐用于专业应用
- **TIFF**：支持32位浮点数，最高精度
- **RAW**：原始二进制数据

#### 3D格式

- **OBJ**：通用3D格式，支持大多数3D软件
- **STL**：适合3D打印
- **PLY**：点云格式

#### 数据格式

- **NumPy (.npy)**：Python原生格式，保留完整精度
- **参数文件 (.json)**：保存所有生成参数，用于复现

## 🗂️ 项目结构

```
Terrain/
├── terrain_generator.py    # 主程序入口
├── config.yaml              # 全局配置文件
├── requirements.txt         # 依赖包列表
│
├── core/                    # 核心模块
│   ├── __init__.py
│   ├── terrain_generator.py # 地形生成核心算法
│   └── terrain_params.py    # 参数定义
│
├── ui/                      # 用户界面
│   ├── main_window.py       # 主窗口
│   ├── control_panel.py     # 控制面板
│   └── preview_canvas.py    # 预览画布
│
├── utils/                   # 工具模块
│   ├── file_io.py          # 文件输入输出
│   ├── image_utils.py      # 图像处理工具
│   └── math_utils.py       # 数学工具
│
├── presets/                 # 预设文件夹
│   └── preset_manager.py   # 预设管理器
│
└── exports/                 # 导出文件夹（自动创建）
```

## 🔧 配置文件

编辑 `config.yaml` 可以自定义全局设置：

```yaml
generator:
  default_size: [1024, 1024]  # 默认地形尺寸
  num_regions: 4              # 默认分区数
  
output:
  format: png                 # 默认导出格式
  bit_depth: 16              # 默认位深度
  
ui:
  theme: dark                # 界面主题
  language: zh               # 界面语言
  
performance:
  use_gpu: false            # GPU加速（待实现）
  chunk_size: 256           # 分块处理大小
```

## 💡 使用技巧

### 生成逼真的山脉

1. 选择**汇聚型**板块边界
2. 设置较高的**构造抬升强度**（0.7-0.9）
3. 增加**降水量**以形成河流切割
4. 适当的**侵蚀迭代**使山脉更加真实

### 生成平缓高原

1. 选择**汇聚型**或**稳定型**边界
2. 中等**构造抬升强度**（0.5-0.7）
3. 降低**降水量**减少侵蚀
4. 增加**地形年龄**使地形更加圆润

### 生成沿海地形

1. 设置较小的**距海岸距离**（0.0-0.3）
2. 增加**降水量**
3. 适当的**风力强度**
4. 使用多个**分区**模拟不同地质单元

### 复现特定地形

1. 记录或保存使用的**随机种子**
2. 保存参数为预设
3. 使用相同的种子和参数可以完全复现

## 🛠️ 开发

### 核心算法

地形生成采用以下算法：

1. **Perlin噪声**：生成基础地形起伏
2. **分形布朗运动(fBm)**：多尺度细节叠加
3. **流体模拟**：河流侵蚀和泥沙沉积
4. **热侵蚀**：热力学侵蚀模拟
5. **后处理**：平滑、归一化等

### 扩展开发

如需添加新功能：

1. **添加新的地质过程**：在 `core/terrain_generator.py` 中添加新方法
2. **添加新的参数**：在 `core/terrain_params.py` 中定义
3. **添加UI控件**：在 `ui/control_panel.py` 中添加控制组件
4. **添加新的导出格式**：在 `utils/file_io.py` 中实现

## 📝 已知问题

- [ ] 大尺寸地形（>2048）生成较慢
- [ ] 3D预览功能仍在开发中
- [ ] GPU加速暂未实现
- [ ] 部分导出格式可能不支持所有图像查看器

## 🗺️ 未来计划

- [ ] GPU加速支持（CUDA/OpenCL）
- [ ] 更多地质过程（火山、喀斯特等）
- [ ] 纹理生成（土壤、植被、岩石）
- [ ] 真实光照渲染
- [ ] 动画导出（地形演化过程）
- [ ] 批量生成和脚本API

## 📄 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

## 🤝 贡献

欢迎提交问题报告和功能请求！

如果您想贡献代码：
1. Fork 本项目
2. 创建您的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启一个 Pull Request

## 📧 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 项目 Issue 页面
- Email: [5712.cg8@gmail.com](mailto://5712.cg8@gmail.com)

## 🙏 致谢

本项目使用了以下优秀的开源库：
- [PyQt5](https://www.riverbankcomputing.com/software/pyqt/) - GUI框架
- [NumPy](https://numpy.org/) - 数值计算
- [Pillow](https://python-pillow.org/) - 图像处理
- [SciPy](https://scipy.org/) - 科学计算

---

**祝您使用愉快！如果觉得有用，请给个 ⭐ Star！**
